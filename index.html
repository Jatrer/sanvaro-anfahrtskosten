<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Anfahrtspauschale berechnen | Sanvaro GmbH</title>
  <meta name="description" content="Anfahrtspauschale schnell berechnen – auf Basis der Straßenroute ab Firmensitz. Preis als Pauschale." />
  <style>
    :root{
      --bg:#f2f2f2;
      --card:#ffffff;
      --text:#222;
      --muted:#666;
      --dark:#1f1f1f;
      --line:#e7e7e7;
      --shadow:0 4px 14px rgba(0,0,0,.08);
      --r:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit}
    .header{background:var(--dark);color:#fff}
    .header .wrap{max-width:1100px;margin:0 auto;padding:18px 16px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}
    .brandTitle{font-size:20px;font-weight:700;letter-spacing:1px}
    .brandSub{font-size:13px;color:#ccc}
    .linkTop{color:#fff;text-decoration:none;font-size:14px}
    .main{max-width:1100px;margin:40px auto;padding:0 16px}
    .card{background:var(--card);border-radius:var(--r);padding:24px;box-shadow:var(--shadow)}
    h1{margin:0 0 6px}
    .hint{color:var(--muted);font-size:15px;margin:0 0 18px}
    label{font-weight:600;display:block;margin-bottom:6px}
    input{
      width:100%;padding:14px;border:1px solid #ccc;border-radius:10px;
      font-size:15px;outline:none;
    }
    input:focus{border-color:#999}
    .btn{
      margin-top:14px;padding:14px 22px;border-radius:10px;border:0;background:var(--dark);
      color:#fff;font-size:15px;cursor:pointer
    }
    .btn:disabled{opacity:.7;cursor:not-allowed}
    .out{
      display:none;margin-top:18px;padding:18px;border-radius:12px;background:#f7f7f7;border:1px solid var(--line)
    }
    .priceRow{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap}
    .price{font-size:22px;margin:0}
    .subnote{margin:6px 0 0;color:var(--muted);font-size:13px}
    .grid2{margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:640px){.grid2{grid-template-columns:1fr}}
    .box{background:#fff;border:1px solid var(--line);border-radius:10px;padding:12px}
    .k{font-size:12px;color:var(--muted);margin-bottom:6px}
    .v{font-size:15px;font-weight:700}
    .cta{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
    .cta a{padding:12px 18px;border-radius:10px;text-decoration:none;border:1px solid #ccc}
    .cta a.primary{background:var(--dark);color:#fff;border-color:var(--dark)}
    .small{margin-top:12px;color:var(--muted);font-size:12.5px;line-height:1.45}
    .footer{background:var(--dark);color:#ccc;margin-top:60px}
    .footer .wrap{max-width:1100px;margin:0 auto;padding:20px 16px;display:flex;flex-wrap:wrap;gap:14px;justify-content:space-between;align-items:center;font-size:13px}
    .footer a{color:#ccc;text-decoration:none}
  </style>
</head>

<body>
  <!-- HEADER -->
  <div class="header">
    <div class="wrap">
      <div>
        <div class="brandTitle">SANVARO GMBH</div>
        <div class="brandSub">Weil Qualität kein Zufall ist</div>
      </div>
      <a class="linkTop" href="https://www.sanvaro.de/">Zurück zur Homepage</a>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="main">
    <div class="card">
      <h1>Anfahrtspauschale berechnen</h1>
      <p class="hint">Berechnung nach Straßenroute ab <b>Firmensitz</b>.</p>

      <label for="addr">Ihre Adresse</label>
      <input id="addr" placeholder="Musterstraße 1, 12345 Musterstadt" autocomplete="street-address" />

      <button id="calcBtn" class="btn">Pauschale berechnen</button>

      <div id="out" class="out"></div>

      <noscript>
        <div class="out" style="display:block;background:#fff2f2;border:1px solid #ffcccc;">
          Bitte JavaScript im Browser aktivieren, damit der Rechner funktioniert.
        </div>
      </noscript>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="footer">
    <div class="wrap">
      <div>© Sanvaro GmbH</div>
      <div style="display:flex;gap:16px;flex-wrap:wrap;">
        <a href="https://www.sanvaro.de/">Homepage</a>
        <a href="https://www.sanvaro.de/impressum/">Impressum</a>
        <a href="https://www.sanvaro.de/datenschutzerklaerung/">Datenschutz</a>
      </div>
    </div>
  </div>

<script>
/* =========================
   FESTE DATEN
========================= */
const ORIGIN = "Holzweg 15, 97656 Oberstreu, Deutschland";
const CONTACT_EMAIL = "kontakt@sanvaro.de";
const PHONE_SASCHA = "+4917624740989";
const PHONE_JUSTIN = "+4917661907607";

/* =========================
   PREISLOGIK (brutto, kundenfreundlich)
   - Kunde sieht NUR Endpreis (Pauschale)
   - Netto intern -> Brutto inkl. 19% MwSt.
   - Deutlich realistischer als zu niedrige Werte
========================= */
const VAT = 0.19;

// „Preis auf Anfrage“ ab sehr großer Entfernung
const ASK_OVER_ONEWAY_KM = 220;

// Bausteine (netto)
const BASE_NET = 65;      // Grundpauschale netto
const MIN_GROSS = 199;    // Mindestpauschale brutto (damit nicht zu günstig)

// Degressiv: lange Strecken werden pro km / pro Stunde günstiger (aber rentabel)
const KM_NEAR = 1.05;     // €/km netto (kurz)
const KM_FAR  = 0.70;     // €/km netto (lang)
const KM_CURVE = 60;

const H_NEAR = 58;        // €/h netto (kurz)
const H_FAR  = 34;        // €/h netto (lang)
const H_CURVE = 2.4;

const ROUND_STEP = 5;

const includedText =
"Die Anfahrtspauschale beinhaltet die komplette Hin- und Rückfahrt, die Fahrtzeit des Teams als Arbeitszeit sowie sämtliche Fahrzeugkosten.";

const individualHint =
"Für individuelle Projekte, besondere handwerkliche Leistungen oder längere Einsätze erstellen wir Ihnen selbstverständlich gerne ein passgenaues Angebot.";

const legalHint =
"Hinweis: Die Pauschale gilt für die reguläre An- und Abfahrt. Bei außergewöhnlichen Umständen (z. B. Sperrungen, extreme Staus, Fähren/Insellage, Maut-/Zufahrts- sowie Parkgebühren oder zusätzliche Anfahrten) können Zusatzkosten entstehen. Diese stimmen wir selbstverständlich vorab transparent mit Ihnen ab.";

const islandHint =
"Hinweis: Bei Inselanreisen/Fährverbindungen können zusätzliche Kosten (z. B. Fährgebühren oder Insel-Logistik) anfallen. Diese stimmen wir vorab transparent mit Ihnen ab.";

function isIsland(text){
  const t = (text || "").toLowerCase();
  return ["insel","sylt","spiekeroog","borkum","norderney","fehmarn","helgoland"].some(k => t.includes(k));
}

function roundUpToStep(x, step){ return Math.ceil(x / step) * step; }

function degressiveRate(x, near, far, curve){
  return far + (near - far) * Math.exp(-x / curve);
}

function euro(n){
  const v = Math.round(n);
  return v.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".") + " €";
}

function kmFmt(x){ return x.toFixed(1).replace(".", ",") + " km"; }
function minFmt(x){ return Math.round(x) + " Minuten"; }

function calcGross(km_oneway, min_oneway){
  if(km_oneway >= ASK_OVER_ONEWAY_KM) return { type:"ask" };

  const km_total = km_oneway * 2;
  const hours_total = (min_oneway * 2) / 60;

  const kmRate = degressiveRate(km_oneway, KM_NEAR, KM_FAR, KM_CURVE);
  const hRate  = degressiveRate(hours_total, H_NEAR, H_FAR, H_CURVE);

  const net = BASE_NET + (km_total * kmRate) + (hours_total * hRate);
  let gross = net * (1 + VAT);

  gross = Math.max(gross, MIN_GROSS);
  gross = roundUpToStep(gross, ROUND_STEP);

  return { type:"price", gross };
}

/* =========================
   ROUTING (OpenStreetMap + OSRM)
========================= */
async function geocode(addr){
  const url = `https://nominatim.openstreetmap.org/search?format=json&limit=1&countrycodes=de&q=${encodeURIComponent(addr)}`;
  const res = await fetch(url, { headers: { "Accept":"application/json" }});
  const data = await res.json();
  if(!data[0]) throw new Error("Adresse nicht gefunden");
  return { lon:data[0].lon, lat:data[0].lat };
}

async function route(a,b){
  const url = `https://router.project-osrm.org/route/v1/driving/${a.lon},${a.lat};${b.lon},${b.lat}?overview=false`;
  const res = await fetch(url, { headers: { "Accept":"application/json" }});
  const data = await res.json();
  if(!data.routes || !data.routes[0]) throw new Error("Route nicht gefunden");
  return {
    km_oneway: data.routes[0].distance / 1000,
    min_oneway: data.routes[0].duration / 60
  };
}

/* =========================
   UI
========================= */
const btn = document.getElementById("calcBtn");
const addrEl = document.getElementById("addr");
const out = document.getElementById("out");

function setLoading(on){
  btn.disabled = on;
  btn.textContent = on ? "Berechne…" : "Pauschale berechnen";
}

function render(resultHtml){
  out.style.display = "block";
  out.innerHTML = resultHtml;
}

btn.addEventListener("click", async () => {
  const dest = addrEl.value.trim();
  if(!dest){
    render("Bitte geben Sie eine vollständige Adresse ein.");
    return;
  }

  setLoading(true);
  render("Berechne…");

  try{
    const a = await geocode(ORIGIN);
    const b = await geocode(dest);
    const r = await route(a,b);

    const km_total = r.km_oneway * 2;
    const min_total = r.min_oneway * 2;

    const outcome = calcGross(r.km_oneway, r.min_oneway);
    const island = isIsland(dest);

    let priceLine = "";
    let vatLine = "";
    if(outcome.type === "ask"){
      priceLine = "Anfahrtspauschale auf Anfrage";
      vatLine = "Bei dieser Entfernung erstellen wir Ihnen gerne ein individuelles Angebot.";
    }else{
      priceLine = `${euro(outcome.gross)} Anfahrtspauschale`;
      vatLine = "inkl. 19% MwSt.";
    }

    render(`
      <div class="priceRow">
        <div>
          <p class="price"><b>${priceLine}</b></p>
          <p class="subnote">${vatLine}</p>
        </div>
      </div>

      <div class="grid2">
        <div class="box">
          <div class="k">Entfernung</div>
          <div class="v">Einfach: ${kmFmt(r.km_oneway)} &nbsp;|&nbsp; Gesamt: ${kmFmt(km_total)}</div>
        </div>
        <div class="box">
          <div class="k">Fahrzeit</div>
          <div class="v">Einfach: ca. ${minFmt(r.min_oneway)} &nbsp;|&nbsp; Gesamt: ca. ${minFmt(min_total)}</div>
        </div>
      </div>

      <div class="small" style="margin-top:12px;">
        ${includedText}<br><br>
        <i>${individualHint}</i><br><br>
        ${legalHint}
        ${island ? `<br><br>${islandHint}` : ""}
      </div>

      <div class="cta">
        <a class="primary" href="mailto:${CONTACT_EMAIL}">Jetzt anfragen</a>
        <a href="tel:${PHONE_SASCHA}">Sascha anrufen</a>
        <a href="tel:${PHONE_JUSTIN}">Justin anrufen</a>
      </div>
    `);

  }catch(e){
    render("Adresse konnte nicht berechnet werden. Bitte prüfen Sie Straße, PLZ und Ort.");
  }finally{
    setLoading(false);
  }
});

addrEl.addEventListener("keydown", (ev) => {
  if(ev.key === "Enter") btn.click();
});
</script>
</body>
</html>
